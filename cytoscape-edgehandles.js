(function e(t,r){if(typeof exports==="object"&&typeof module==="object")module.exports=r(require("lodash.throttle"),require("lodash.memoize"));else if(typeof define==="function"&&define.amd)define(["lodash.throttle","lodash.memoize"],r);else if(typeof exports==="object")exports["cytoscapeEdgehandles"]=r(require("lodash.throttle"),require("lodash.memoize"));else t["cytoscapeEdgehandles"]=r(t["_"]["throttle"],t["_"]["memoize"])})(window,function(r,i){return function(r){var i={};function n(e){if(i[e]){return i[e].exports}var t=i[e]={i:e,l:false,exports:{}};r[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=r;n.c=i;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:r})}};n.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};n.t=function(t,e){if(e&1)t=n(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var r=Object.create(null);n.r(r);Object.defineProperty(r,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=2)}([function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t,r){"use strict";r.r(t);var i={selector:"node",preview:true,hoverDelay:150,snap:false,snapThreshold:50,snapFrequency:15,noEdgeEventsInDraw:false,disableBrowserGestures:true,handleParams:function e(t){return[{}]},handlePosition:function e(t){return"middle top"},handleInDrawMode:false,edgeType:function e(t,r,i){return"flat"},loopAllowed:function e(t,r){return false},nodeLoopOffset:-50,nodeParams:function e(t,r,i){return{}},edgeParams:function e(t,r,i,n){return{}},ghostEdgeParams:function e(t,r){return{}},show:function e(t,r){},hide:function e(t){},start:function e(t,r){},complete:function e(t,r,i){},stop:function e(t){},cancel:function e(t,r){},hoverover:function e(t,r){},hoverout:function e(t,r){},previewon:function e(t,r,i){},previewoff:function e(t,r,i){},drawon:function e(){},drawoff:function e(){}};var n=i;var w=Object.assign!=null?Object.assign.bind(Object):function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++){t[i-1]=arguments[i]}t.filter(function(e){return e!=null}).forEach(function(t){Object.keys(t).forEach(function(e){return r[e]=t[e]})});return r};var s=r(0);var o=r.n(s);function a(){this.saveGestureState();this.cy.zoomingEnabled(false).panningEnabled(false).boxSelectionEnabled(false);if(this.options.disableBrowserGestures){var e=this.windowListenerOptions;window.addEventListener("touchstart",this.preventDefault,e);window.addEventListener("touchmove",this.preventDefault,e);window.addEventListener("wheel",this.preventDefault,e)}return this}function h(){this.cy.zoomingEnabled(this.lastZoomingEnabled).panningEnabled(this.lastPanningEnabled).boxSelectionEnabled(this.lastBoxSelectionEnabled);if(this.options.disableBrowserGestures){var e=this.windowListenerOptions;window.removeEventListener("touchstart",this.preventDefault,e);window.removeEventListener("touchmove",this.preventDefault,e);window.removeEventListener("wheel",this.preventDefault,e)}return this}function d(){var e=this.cy;this.lastPanningEnabled=e.panningEnabled();this.lastZoomingEnabled=e.zoomingEnabled();this.lastBoxSelectionEnabled=e.boxSelectionEnabled();return this}var u={disableGestures:a,resetGestures:h,saveGestureState:d};function l(){var r=this;var e=this.cy,t=this.options;this.addListener(e,"drag",function(){return r.grabbingNode=true});this.addListener(e,"free",function(){return r.grabbingNode=false});this.addListener(e,"mouseover","node",function(e){r.show(e.target)});this.addListener(e,"tap","node",function(e){r.show(e.target)});this.addListener(e,"position","node",function(){r.hide()});this.addListener(e,"tapstart","node",function(e){var t=e.target;if(t.anySame(r.handleNodes)){r.handleNode=t.intersection(r.handleNodes);r.start(r.sourceNode)}else if(r.drawMode){r.start(t)}else if(t.same(r.sourceNode)){r.hide()}});this.addListener(e,"tapdrag",function(e){r.update(e.position)});this.addListener(e,"tapdragover","node",function(e){if(!t.snap){r.preview(e.target)}});this.addListener(e,"tapdragout","node",function(e){if(!t.snap){r.unpreview(e.target)}});this.addListener(e,"tapend",function(){r.stop()});this.addListener(e,"remove",function(e){if(e.target.same(r.sourceNode)){r.hide()}});return this}var c={addCytoscapeListeners:l};function v(e){var t=this.cy,r=this.options;this.drawMode=e!=null?e:!this.drawMode;if(this.drawMode){this.prevUngrabifyState=t.autoungrabify();t.autoungrabify(true);if(!r.handleInDrawMode&&this.handleShown()){this.hide()}this.emit("drawon")}else{t.autoungrabify(this.prevUngrabifyState);this.emit("drawoff")}return this}function f(){return this.toggleDrawMode(true)}function p(){return this.toggleDrawMode(false)}var m={toggleDrawMode:v,enableDrawMode:f,disableDrawMode:p};function g(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){g=function e(t){return typeof t}}else{g=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return g(e)}var y=function e(t){return Array.isArray?Array.isArray(t):t!=null&&t instanceof Array};function b(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.active){return}var t=this.cy,r=this.options,i=this.presumptiveTargets,n=this.previewEles;if(e&&!r.preview){return}var s=this.sourceNode,o=this.targetNode,a=this.handleNode;if(!o||o.empty()){this.removePreview();this.emit("cancel",this.mp(),s,i);return}if(!e&&n.nonempty()){t.startBatch();n.removeClass("eh-preview").removeStyle("events");t.endBatch();this.emit("complete",this.mp(),s,o,n);return}var h=r.edgeType(s,o,a);if(!h){return}var d;var u=s.position();var l=o.position();if(s.same(o)){d={x:u.x+r.nodeLoopOffset,y:u.y+r.nodeLoopOffset}}else{d={x:(u.x+l.x)/2,y:(u.y+l.y)/2}}var c=t.collection();var v=r.edgeParams(s,o,0,a);t.startBatch();if(h==="node"){var f=r.nodeParams(s,o,a);var p=r.edgeParams(s,o,1,a);var m=t.add(w({},f,{group:"nodes",position:d}));var g=t.add(w({},v,{group:"edges",data:w({},v.data,{source:s.id(),target:m.id()})}));var y=t.add(w({},p,{group:"edges",data:w({},p.data,{source:m.id(),target:o.id()})}));c=c.merge(m).merge(g).merge(y)}else{c=t.add(w({},v,{group:"edges",data:w({},v.data,{source:s.id(),target:o.id()})}))}if(e){c.style("events","no");c.addClass("eh-preview");this.previewEles=c}t.endBatch();if(!e){this.emit("complete",this.mp(),s,o,c)}return this}function E(){this.makeEdges(true);return this}function N(){if(this.previewEles.nonempty()){this.previewEles.remove();this.previewEles=this.cy.collection()}return this}function S(){return this.handleNodes.nonempty()}function L(){if(this.handleNodes.nonempty()){this.handleNodes.remove();this.handleNodes=this.cy.collection()}return this}function x(e){var t=this.options;var r=g(t.handlePosition)===g("")?function(){return t.handlePosition}:t.handlePosition;var i=e.position();var n=e.outerHeight();var s=e.outerWidth();var o=0;var a=0;var h=r(e).toLowerCase().split(/\s+/);var d=h[0];var u=h[1];if(d==="left"){o=-(s/2)}else if(d==="right"){o=s/2}if(u==="top"){a=-(n/2)}else if(u==="bottom"){a=n/2}var l=i.x+o;var c=i.y+a;return{x:l,y:c}}function P(e){var t=this.options,r=this.cy;var i=t.handleParams(e);if(!y(i)){i=[i]}var n=[];for(var s=0;s<i.length;s++){var o=w({},i[s],{group:"nodes",grabbable:false,selectable:false});if(!o.hasOwnProperty("position")){o.position=this.handlePosition(e)}n.push(o)}r.startBatch();this.removeHandles();this.handleNodes=r.add(n);this.handleNodes.addClass("eh-handle");r.endBatch();return this}function O(){var e=this.sourceNode,t=this.ghostNode;var r=this.mx;var i=this.my;if(!e){return}if(t.empty()||t.removed()){var n=this.handleNode,s=this.options,o=this.cy;var a,h;o.startBatch();t=this.ghostNode=o.add({group:"nodes",classes:"eh-ghost eh-ghost-node",position:{x:r,y:i}});t.style({"background-color":"blue",width:1e-4,height:1e-4,opacity:0,events:"no"});var d=s.ghostEdgeParams(e,n);a=o.add(w({},d,{group:"edges",data:w({},d.data,{source:e.id(),target:t.id()})}));a.addClass("eh-ghost eh-ghost-edge");a.style("events","no");h=this.ghostEles=o.collection();h.merge(t).merge(a);o.endBatch()}else{this.ghostNode.position({x:r,y:i})}return this}var M={makeEdges:b,makePreview:E,removePreview:N,updateEdge:O,handleShown:S,handlePosition:x,makeHandles:P,removeHandles:L};function C(){this.enabled=true;this.emit("enable");return this}function D(){this.enabled=false;this.emit("disable");return this}var k={enable:C,disable:D};var T=r(1);var j=Math.sqrt(2);function B(e){var r=this.options,i=this.previewEles,n=this.ghostEles,s=this.handleNodes;var o=function e(t){return i.anySame(t)};var a=function e(t){return s.anySame(t)};var h=function e(t){return n.anySame(t)};var t=function e(t){return o(t)||a(t)||h(t)};var d=function e(t){return t.filter(r.selector).nonempty()};var u=this.enabled,l=this.active,c=this.grabbingNode;return u&&!l&&!c&&e!=null&&e.inside()&&!t(e)&&d(e)}function G(e){return this.canStartOn(e)&&this.drawMode}function H(e){return this.canStartOn(e)&&!this.drawMode}function A(e){var t=this.options,r=this.drawMode;if(!this.canStartOn(e)||r&&!t.handleInDrawMode){return}this.sourceNode=e;this.makeHandles(e);this.emit("show",this.mp(),e,this.handleNodes);return this}function _(){this.removeHandles();this.emit("hide",this.mp(),this.sourceNode);return this}function q(e){if(!this.canStartOn(e)){return}this.active=true;this.sourceNode=e;this.sourceNode.addClass("eh-source");this.disableGestures();this.disableEdgeEvents();this.emit("start",this.mp(),e,this.handleNode)}function z(e){if(!this.active){return}var t=e;this.mx=t.x;this.my=t.y;this.updateEdge();this.throttledSnap();return this}function I(){if(!this.active||!this.options.snap){return false}var e=this.cy;var t=this.targetNode;var n=this.options.snapThreshold;var w=this.mp();var r=this.handleNode,i=this.previewEles,s=this.ghostNode;var o=function e(t){return j*Math.max(t.outerWidth(),t.outerHeight())/2};var b=function e(t,r,i,n){var s=i-t;var o=n-r;return s*s+o*o};var a=function e(t,r){return b(t.x,t.y,r.x,r.y)};var h=function e(t){return a(t.position(),w)};var d=function e(t){var r=o(t);var i=r+n;return i*i};var u=function e(t){return h(t)<=d(t)};var l=function e(t){var r=t.position();var i=t.outerWidth()/2;var n=t.outerHeight()/2;var s=r.x;var o=r.y;var a=w.x;var h=w.y;var d=s-i;var u=s+i;var l=o-n;var c=o+n;var v=d<=a&&a<=u;var f=l<=h&&h<=c;if(v&&f){return 0}else if(v){var p=h-l;var m=h-c;return Math.min(p*p,m*m)}else if(f){var g=a-d;var y=a-u;return Math.min(g*g,y*y)}else if(a<d&&h<l){return b(a,h,d,l)}else if(a>u&&h<l){return b(a,h,u,l)}else if(a<d&&h>c){return b(a,h,d,c)}else{return b(a,h,u,c)}};var c=function e(t,r){return l(t)-l(r)};var v=c;var f=false;var p=function e(t){var r=w;var i=t.outerWidth();var n=i/2;var s=t.outerHeight();var o=s/2;var a=t.position();var h=a.x-n;var d=a.x+n;var u=a.y-o;var l=a.y+o;return h<=r.x&&r.x<=d&&u<=r.y&&r.y<=l};var m=function e(t){return t.same(r)||t.same(i)||t.same(s)};var g=e.nodes(function(e){return!m(e)&&u(e)}).sort(v);var y=false;if(t.nonempty()&&!u(t)){this.unpreview(t)}for(var E=0;E<g.length;E++){var N=g[E];if(N.isParent()&&p(N)){continue}if(N.isChild()&&!p(N.parent())){continue}if(N.same(t)||this.preview(N,f)){y=true;break}}return y}function W(t){var r=this;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var i=this.options,n=this.sourceNode,s=this.ghostNode,o=this.handleNode,a=this.ghostEles,h=this.presumptiveTargets,d=this.previewEles,u=this.active;var l=n;var c=t.same(l);var v=i.loopAllowed(t,o);var f=t.same(s);var p=!i.edgeType(l,t,o);var m=t.anySame(this.handleNodes);var g=t.same(this.targetNode);if(!u||m||f||p||g||c&&!v){return false}if(this.targetNode.nonempty()){this.unpreview(this.targetNode)}clearTimeout(this.previewTimeout);var y=function e(){r.targetNode=t;h.merge(t);t.addClass("eh-presumptive-target");t.addClass("eh-target");r.emit("hoverover",r.mp(),l,t);if(i.preview){t.addClass("eh-preview");a.addClass("eh-preview-active");n.addClass("eh-preview-active");t.addClass("eh-preview-active");r.makePreview();r.emit("previewon",r.mp(),l,t,d)}};if(e&&i.hoverDelay>0){this.previewTimeout=setTimeout(y,i.hoverDelay)}else{y()}return true}function F(e){if(!this.active||e.anySame(this.handleNodes)){return}var t=this.ghostEles,r=this.previewEles,i=this.cy;var n=this.sourceNode;clearTimeout(this.previewTimeout);this.previewTimeout=null;n.removeClass("eh-preview-active");e.removeClass("eh-preview-active eh-preview eh-target eh-presumptive-target");t.removeClass("eh-preview-active");this.targetNode=i.collection();this.removePreview();this.emit("hoverout",this.mp(),n,e);this.emit("previewoff",this.mp(),n,e,r);return this}function U(){if(!this.active){return}var e=this.sourceNode;clearTimeout(this.previewTimeout);this.sourceNode.removeClass("eh-source");this.targetNode.removeClass("eh-target eh-preview eh-hover");this.presumptiveTargets.removeClass("eh-presumptive-target");this.ghostEles.remove();this.removeHandles();this.makeEdges();this.clearCollections();this.resetGestures();this.enableEdgeEvents();this.active=false;this.emit("stop",this.mp(),e);return this}var Z={show:A,hide:_,start:q,update:z,preview:W,unpreview:F,stop:U,snap:I,canStartOn:B,canStartDrawModeOn:G,canStartNonDrawModeOn:H};function J(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){J=function e(t){return typeof t}}else{J=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return J(e)}function K(){var e=this;this.addCytoscapeListeners();this.addListener(this.cy,"destroy",function(){return e.destroy()});return this}function Q(){for(var e=this.listeners.length-1;e>=0;e--){var t=this.listeners[e];this.removeListener(t.target,t.event,t.selector,t.callback,t.options)}return this}function R(e,t,r,i,n){if(J(r)!==J("")){i=r;n=i;r=null}if(n==null){n=false}return{target:e,event:t,selector:r,callback:i,options:n}}function V(e){return e instanceof Element}function X(e,t,r,i,n){var s=R(e,t,r,i,n);this.listeners.push(s);if(V(s.target)){s.target.addEventListener(s.event,s.callback,s.options)}else{if(s.selector){s.target.addListener(s.event,s.selector,s.callback,s.options)}else{s.target.addListener(s.event,s.callback,s.options)}}return this}function Y(e,t,r,i,n){var s=R(e,t,r,i,n);for(var o=this.listeners.length-1;o>=0;o--){var a=this.listeners[o];if(s.target===a.target&&s.event===a.event&&(s.selector==null||s.selector===a.selector)&&(s.callback==null||s.callback===a.callback)){this.listeners.splice(o,1);if(V(s.target)){s.target.removeEventListener(s.event,s.callback,s.options)}else{if(s.selector){s.target.removeListener(s.event,s.selector,s.callback,s.options)}else{s.target.removeListener(s.event,s.callback,s.options)}}break}}return this}function $(e,t){var r=this.options,i=this.cy;for(var n=arguments.length,s=new Array(n>2?n-2:0),o=2;o<n;o++){s[o-2]=arguments[o]}i.emit({type:"eh".concat(e),position:t},s);var a=r[e];if(a!=null){a.apply(void 0,s)}return this}var ee={addListener:X,addListeners:K,removeListener:Y,removeListeners:Q,emit:$};function te(){if(this.options.noEdgeEventsInDraw){this.cy.edges().style("events","no")}return this}function re(){if(this.options.noEdgeEventsInDraw){this.cy.edges().removeStyle("events")}return this}var ie={disableEdgeEvents:te,enableEdgeEvents:re};function ne(e,t){this.cy=e;this.listeners=[];this.enabled=true;this.drawMode=false;this.active=false;this.grabbingNode=false;this.handleNodes=e.collection();this.clearCollections();this.mx=0;this.my=0;this.options=w({},n,t);this.saveGestureState();this.addListeners();this.throttledSnap=o()(this.snap.bind(this),1e3/this.options.snapFrequency);this.preventDefault=function(e){return e.preventDefault()};var r=false;try{var i=Object.defineProperty({},"passive",{get:function e(){r=true;return undefined}});window.addEventListener("_",null,i)}catch(e){}if(r){this.windowListenerOptions={capture:true,passive:false}}else{this.windowListenerOptions=true}}var se=ne.prototype={};se.destroy=function(){this.removeListeners()};se.setOptions=function(e){w(this.options,e)};se.mp=function(){return{x:this.mx,y:this.my}};se.clearCollections=function(){var e=this.cy;this.handleNode=e.collection();this.previewEles=e.collection();this.ghostNode=e.collection();this.ghostEles=e.collection();this.sourceNode=e.collection();this.targetNode=e.collection();this.presumptiveTargets=e.collection()};var oe=function e(t){return w(se,t)};var ae=[u,c,m,M,k,Z,ee,ie];ae.forEach(oe);var he=ne;var de=function(e){var t=this;if(e&&e.hasOwnProperty("handleNodes")){e.selector=e.handleNodes;delete e.handleNodes}return new he(t,e)};var ue=function e(t){if(!t){return}t("core","edgehandles",de)};if(typeof cytoscape!=="undefined"){ue(cytoscape)}var le=t["default"]=ue}])});